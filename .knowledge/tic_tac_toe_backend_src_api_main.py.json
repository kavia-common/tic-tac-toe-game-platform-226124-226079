{"is_source_file": true, "format": "Python", "description": "Main source file for the backend API of a Tic Tac Toe game platform, using FastAPI. It defines API endpoints for health checks, player management, game creation and retrieval, making moves, viewing game history, and leaderboard calculations. It includes data models, API route handlers, and app configuration.", "external_files": ["src/db/database.py", "src/db/repositories.py", "src/db/models.py", "src.api.game_service.py"], "external_methods": ["init_db", "get_session", "create_new_game", "apply_move", "board_to_list", "compute_current_player", "map_status_for_api", "map_winner_for_api"], "published": ["app"], "classes": [{"name": "PlayerCreate", "description": "Schema for creating a new player, includes username and optional display name."}, {"name": "PlayerOut", "description": "Schema for returning player info, including ID, username, and display name."}, {"name": "CreateGameRequest", "description": "Schema for creating a new game, optionally specifying player IDs for X and O."}, {"name": "GameState", "description": "Represents the state of a game, including board layout, current player, status, and winner."}, {"name": "MoveRequest", "description": "Schema for submitting a move, including position and optional player ID."}, {"name": "MoveHistoryItem", "description": "Represents a move in the game history, with move ID, position, and player symbol."}, {"name": "LeaderboardEntry", "description": "Represents a player\u2019s leaderboard stats: username, wins, losses, draws, and score."}], "methods": [{"name": "health_check()", "description": "Health check endpoint returning a simple 'Healthy' message.", "scope": "", "scopeKind": ""}, {"name": "PlayerOut create_player(payload: PlayerCreate, session: Session = Depends(get_session))", "description": "Creates a new player with a unique username.", "scope": "", "scopeKind": ""}, {"name": "GameState create_game(payload: CreateGameRequest = Body(default=CreateGameRequest()), session: Session = Depends(get_session))", "description": "Creates a new game instance, optionally with specified players.", "scope": "", "scopeKind": ""}, {"name": "GameState get_game( game_id: int = Path(..., description=\"Game ID\"), session: Session = Depends(get_session), )", "description": "Fetches current game state by game ID.", "scope": "", "scopeKind": ""}, {"name": "GameState make_move( game_id: int = Path(..., description=\"Game ID\"), payload: MoveRequest = Body(...), session: Session = Depends(get_session), )", "description": "Validates and applies a move to the game, returning updated game state.", "scope": "", "scopeKind": ""}, {"name": "List[MoveHistoryItem] game_history( game_id: int = Path(..., description=\"Game ID\"), session: Session = Depends(get_session), )", "description": "Returns move history for a specified game.", "scope": "", "scopeKind": ""}, {"name": "List[LeaderboardEntry] leaderboard(session: Session = Depends(get_session))", "description": "Computes and returns the leaderboard of players based on game results.", "scope": "", "scopeKind": ""}, {"name": "None on_startup()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] username_for(player_id: Optional[int])", "scope": "leaderboard", "scopeKind": "function", "description": "unavailable"}], "calls": ["init_db", "get_session", "create_new_game", "apply_move", "board_to_list", "compute_current_player", "map_status_for_api", "map_winner_for_api", "PlayerRepository.get_by_username", "PlayerRepository.create", "GameRepository.get_by_id", "GameRepository.list", "MoveRepository.list_for_game", "LeaderBoardService.compute", "PlayerRepository.get_by_id"], "search-terms": ["FastAPI", "tic tac toe", "game creation", "move application", "leaderboard", "game state", "health check", "player management"], "state": 2, "file_id": 3, "knowledge_revision": 22, "git_revision": "4a493c4eee385e10a0cf366f198c8ff3b8329b9a", "revision_history": [{"8": "ea4247d497c2e00a63d5faf52d60604f53c0c703"}, {"13": "ea4247d497c2e00a63d5faf52d60604f53c0c703"}, {"18": "5c24b9ff2747466288d748197d5cb07ba179fd12"}, {"21": "5c24b9ff2747466288d748197d5cb07ba179fd12"}, {"22": "4a493c4eee385e10a0cf366f198c8ff3b8329b9a"}], "ctags": [{"_type": "tag", "name": "CreateGameRequest", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class CreateGameRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GameState", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GameState(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LeaderboardEntry", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class LeaderboardEntry(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MoveHistoryItem", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class MoveHistoryItem(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MoveRequest", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class MoveRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PR", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    from src.db.repositories import PlayerRepository as PR$/", "file": true, "language": "Python", "kind": "unknown", "scope": "leaderboard", "scopeKind": "function", "nameref": "unknown:PlayerRepository"}, {"_type": "tag", "name": "PlayerCreate", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class PlayerCreate(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PlayerOut", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class PlayerOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "allow_origins", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    allow_origins = [\"*\"]$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "board", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    board: List[str] = Field(..., min_items=9, max_items=9, description=\"Board as 9 strings\")$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable", "scope": "GameState", "scopeKind": "class"}, {"_type": "tag", "name": "cors_origins_env", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^cors_origins_env = os.getenv(\"CORS_ORIGINS\", \"http:\\/\\/localhost:3000\").strip()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "create_game", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def create_game(payload: CreateGameRequest = Body(default=CreateGameRequest()), session: Session/", "language": "Python", "typeref": "typename:GameState", "kind": "function", "signature": "(payload: CreateGameRequest = Body(default=CreateGameRequest()), session: Session = Depends(get_session))"}, {"_type": "tag", "name": "create_player", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def create_player(payload: PlayerCreate, session: Session = Depends(get_session)) -> PlayerOut:$/", "language": "Python", "typeref": "typename:PlayerOut", "kind": "function", "signature": "(payload: PlayerCreate, session: Session = Depends(get_session))"}, {"_type": "tag", "name": "display_name", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    display_name: Optional[str] = Field(None, max_length=100, description=\"Optional display name/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "PlayerCreate", "scopeKind": "class"}, {"_type": "tag", "name": "game_history", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def game_history($/", "language": "Python", "typeref": "typename:List[MoveHistoryItem]", "kind": "function", "signature": "( game_id: int = Path(..., description=\"Game ID\"), session: Session = Depends(get_session), )"}, {"_type": "tag", "name": "get_game", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_game($/", "language": "Python", "typeref": "typename:GameState", "kind": "function", "signature": "( game_id: int = Path(..., description=\"Game ID\"), session: Session = Depends(get_session), )"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "leaderboard", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def leaderboard(session: Session = Depends(get_session)) -> List[LeaderboardEntry]:$/", "language": "Python", "typeref": "typename:List[LeaderboardEntry]", "kind": "function", "signature": "(session: Session = Depends(get_session))"}, {"_type": "tag", "name": "make_move", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def make_move($/", "language": "Python", "typeref": "typename:GameState", "kind": "function", "signature": "( game_id: int = Path(..., description=\"Game ID\"), payload: MoveRequest = Body(...), session: Session = Depends(get_session), )"}, {"_type": "tag", "name": "on_startup", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def on_startup() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "openapi_tags", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^openapi_tags = [$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "player_id", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    player_id: Optional[int] = Field(None, description=\"Optional actor player id for validation\"/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "MoveRequest", "scopeKind": "class"}, {"_type": "tag", "name": "player_o_id", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    player_o_id: Optional[int] = Field(None, description=\"Player ID for O\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "CreateGameRequest", "scopeKind": "class"}, {"_type": "tag", "name": "player_x_id", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    player_x_id: Optional[int] = Field(None, description=\"Player ID for X\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "CreateGameRequest", "scopeKind": "class"}, {"_type": "tag", "name": "position", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    position: int = Field(..., ge=0, le=8, description=\"Cell index 0..8\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "MoveRequest", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., min_length=1, max_length=50, description=\"Unique username\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PlayerCreate", "scopeKind": "class"}, {"_type": "tag", "name": "username_for", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    def username_for(player_id: Optional[int]) -> Optional[str]:$/", "file": true, "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(player_id: Optional[int])", "scope": "leaderboard", "scopeKind": "function"}, {"_type": "tag", "name": "winner", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    winner: Optional[Literal[\"X\", \"O\"]] = None$/", "language": "Python", "typeref": "typename:Optional[Literal[\"X\", \"O\"]]", "kind": "variable", "scope": "GameState", "scopeKind": "class"}], "hash": "0fd0bb0baaa6e6191da2bbc4efd5c143", "format-version": 4, "code-base-name": "tic_tac_toe_backend", "filename": "tic_tac_toe_backend/src/api/main.py", "fields": [{"name": "allow_origins = [\"*\"]", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[str] board", "scope": "GameState", "scopeKind": "class", "description": "unavailable"}, {"name": "cors_origins_env = os.getenv(\"CORS_ORIGINS\", \"http:\\/\\/localhost:3000\").strip()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] display_name", "scope": "PlayerCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "openapi_tags = [", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[int] player_id", "scope": "MoveRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] player_o_id", "scope": "CreateGameRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] player_x_id", "scope": "CreateGameRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "int position", "scope": "MoveRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str username", "scope": "PlayerCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[Literal[\"X\", \"O\"]] winner", "scope": "GameState", "scopeKind": "class", "description": "unavailable"}]}