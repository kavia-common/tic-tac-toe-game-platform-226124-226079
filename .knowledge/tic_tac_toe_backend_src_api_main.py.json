{"is_source_file": true, "format": "Python", "description": "This file is a FastAPI-based backend API implementation for a Tic Tac Toe game platform. It defines API endpoints, request/response schemas, and integrates with database repositories to manage players, games, moves, and leaderboard data.", "external_files": ["src/db/database", "src/db/repositories", "src/db/models", "src.api.game_service"], "external_methods": ["init_db", "get_session", "PlayerRepository.get_by_username", "PlayerRepository.create", "GameRepository.get_by_id", "create_new_game", "board_to_list", "compute_current_player", "map_status_for_api", "map_winner_for_api", "apply_move", "LeaderBoardService.compute", "GameRepository.list", "MoveRepository.list_for_game", "PlayerRepository.get_by_id"], "published": ["app", "health_check", "create_player", "create_game", "get_game", "make_move", "game_history", "leaderboard"], "classes": [{"name": "PlayerCreate", "description": "Pydantic model for creating a new player with username and optional display name."}, {"name": "PlayerOut", "description": "Pydantic model representing player output data including id, username, and display name."}, {"name": "CreateGameRequest", "description": "Pydantic model for creating a new game with optional player IDs for X and O."}, {"name": "GameState", "description": "Pydantic model for representing current game state, including board, current player, status, and winner."}, {"name": "MoveRequest", "description": "Pydantic model for applying a move, specifying position and optional player ID."}, {"name": "MoveHistoryItem", "description": "Pydantic model for a move history entry with move ID, position, and player mark."}, {"name": "LeaderboardEntry", "description": "Pydantic model for leaderboard entry including username, wins, losses, draws, and score."}], "methods": [{"name": "health_check()", "description": "A simple endpoint to check the service health status.", "scope": "", "scopeKind": ""}, {"name": "PlayerOut create_player(payload: PlayerCreate, session: Session = Depends(get_session))", "description": "Creates a new player with a unique username in the database.", "scope": "", "scopeKind": ""}, {"name": "GameState create_game(payload: CreateGameRequest = Body(default=CreateGameRequest()), session: Session = Depends(get_session))", "description": "Creates a new game with optional initial players and returns its initial state.", "scope": "", "scopeKind": ""}, {"name": "GameState get_game( game_id: int = Path(..., description=\"Game ID\"), session: Session = Depends(get_session), )", "description": "Fetches the current state of a specified game by ID.", "scope": "", "scopeKind": ""}, {"name": "GameState make_move( game_id: int = Path(..., description=\"Game ID\"), payload: MoveRequest = Body(...), session: Session = Depends(get_session), )", "description": "Validates and applies a move to a game, returning the updated game state.", "scope": "", "scopeKind": ""}, {"name": "List[MoveHistoryItem] game_history( game_id: int = Path(..., description=\"Game ID\"), session: Session = Depends(get_session), )", "description": "Returns the chronological move history for a specific game.", "scope": "", "scopeKind": ""}, {"name": "List[LeaderboardEntry] leaderboard(session: Session = Depends(get_session))", "description": "Computes and returns the leaderboard based on game results.", "scope": "", "scopeKind": ""}, {"name": "None on_startup()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[str] username_for(player_id: Optional[int])", "scope": "leaderboard", "scopeKind": "function", "description": "unavailable"}], "calls": ["init_db", "get_session", "PlayerRepository.get_by_username", "PlayerRepository.create", "GameRepository.get_by_id", "create_new_game", "board_to_list", "compute_current_player", "map_status_for_api", "map_winner_for_api", "apply_move", "LeaderBoardService.compute", "GameRepository.list", "MoveRepository.list_for_game", "PlayerRepository.get_by_id"], "search-terms": ["tic_tac_toe_backend", "create_player", "create_game", "get_game", "make_move", "game_history", "leaderboard", "FastAPI", "API endpoints", "game state", "move application"], "state": 2, "file_id": 3, "knowledge_revision": 21, "git_revision": "5c24b9ff2747466288d748197d5cb07ba179fd12", "revision_history": [{"8": "ea4247d497c2e00a63d5faf52d60604f53c0c703"}, {"13": "ea4247d497c2e00a63d5faf52d60604f53c0c703"}, {"18": "5c24b9ff2747466288d748197d5cb07ba179fd12"}, {"21": "5c24b9ff2747466288d748197d5cb07ba179fd12"}], "ctags": [{"_type": "tag", "name": "CreateGameRequest", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class CreateGameRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GameState", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class GameState(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LeaderboardEntry", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class LeaderboardEntry(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MoveHistoryItem", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class MoveHistoryItem(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "MoveRequest", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class MoveRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PR", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    from src.db.repositories import PlayerRepository as PR$/", "file": true, "language": "Python", "kind": "unknown", "scope": "leaderboard", "scopeKind": "function", "nameref": "unknown:PlayerRepository"}, {"_type": "tag", "name": "PlayerCreate", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class PlayerCreate(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PlayerOut", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^class PlayerOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "board", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    board: List[str] = Field(..., min_items=9, max_items=9, description=\"Board as 9 strings\")$/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable", "scope": "GameState", "scopeKind": "class"}, {"_type": "tag", "name": "create_game", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def create_game(payload: CreateGameRequest = Body(default=CreateGameRequest()), session: Session/", "language": "Python", "typeref": "typename:GameState", "kind": "function", "signature": "(payload: CreateGameRequest = Body(default=CreateGameRequest()), session: Session = Depends(get_session))"}, {"_type": "tag", "name": "create_player", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def create_player(payload: PlayerCreate, session: Session = Depends(get_session)) -> PlayerOut:$/", "language": "Python", "typeref": "typename:PlayerOut", "kind": "function", "signature": "(payload: PlayerCreate, session: Session = Depends(get_session))"}, {"_type": "tag", "name": "display_name", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    display_name: Optional[str] = Field(None, max_length=100, description=\"Optional display name/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "PlayerCreate", "scopeKind": "class"}, {"_type": "tag", "name": "game_history", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def game_history($/", "language": "Python", "typeref": "typename:List[MoveHistoryItem]", "kind": "function", "signature": "( game_id: int = Path(..., description=\"Game ID\"), session: Session = Depends(get_session), )"}, {"_type": "tag", "name": "get_game", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def get_game($/", "language": "Python", "typeref": "typename:GameState", "kind": "function", "signature": "( game_id: int = Path(..., description=\"Game ID\"), session: Session = Depends(get_session), )"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "leaderboard", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def leaderboard(session: Session = Depends(get_session)) -> List[LeaderboardEntry]:$/", "language": "Python", "typeref": "typename:List[LeaderboardEntry]", "kind": "function", "signature": "(session: Session = Depends(get_session))"}, {"_type": "tag", "name": "make_move", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def make_move($/", "language": "Python", "typeref": "typename:GameState", "kind": "function", "signature": "( game_id: int = Path(..., description=\"Game ID\"), payload: MoveRequest = Body(...), session: Session = Depends(get_session), )"}, {"_type": "tag", "name": "on_startup", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^def on_startup() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "openapi_tags", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^openapi_tags = [$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "player_id", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    player_id: Optional[int] = Field(None, description=\"Optional actor player id for validation\"/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "MoveRequest", "scopeKind": "class"}, {"_type": "tag", "name": "player_o_id", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    player_o_id: Optional[int] = Field(None, description=\"Player ID for O\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "CreateGameRequest", "scopeKind": "class"}, {"_type": "tag", "name": "player_x_id", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    player_x_id: Optional[int] = Field(None, description=\"Player ID for X\")$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "CreateGameRequest", "scopeKind": "class"}, {"_type": "tag", "name": "position", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    position: int = Field(..., ge=0, le=8, description=\"Cell index 0..8\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "MoveRequest", "scopeKind": "class"}, {"_type": "tag", "name": "username", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    username: str = Field(..., min_length=1, max_length=50, description=\"Unique username\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "PlayerCreate", "scopeKind": "class"}, {"_type": "tag", "name": "username_for", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    def username_for(player_id: Optional[int]) -> Optional[str]:$/", "file": true, "language": "Python", "typeref": "typename:Optional[str]", "kind": "function", "signature": "(player_id: Optional[int])", "scope": "leaderboard", "scopeKind": "function"}, {"_type": "tag", "name": "winner", "path": "/home/kavia/workspace/code-generation/tic-tac-toe-game-platform-226124-226079/tic_tac_toe_backend/src/api/main.py", "pattern": "/^    winner: Optional[Literal[\"X\", \"O\"]] = None$/", "language": "Python", "typeref": "typename:Optional[Literal[\"X\", \"O\"]]", "kind": "variable", "scope": "GameState", "scopeKind": "class"}], "hash": "ac2b4128b486701d1487e50991507aa1", "format-version": 4, "code-base-name": "tic_tac_toe_backend", "filename": "tic_tac_toe_backend/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[str] board", "scope": "GameState", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] display_name", "scope": "PlayerCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "openapi_tags = [", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[int] player_id", "scope": "MoveRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] player_o_id", "scope": "CreateGameRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] player_x_id", "scope": "CreateGameRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "int position", "scope": "MoveRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "str username", "scope": "PlayerCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[Literal[\"X\", \"O\"]] winner", "scope": "GameState", "scopeKind": "class", "description": "unavailable"}]}